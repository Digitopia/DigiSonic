(function(e){function t(t){for(var i,a,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);u&&u(t);while(p.length)p.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(i=!1)}i&&(r.splice(t--,1),e=a(a.s=n[0]))}return e}var i={},o={app:0},r=[];function a(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/DigiSonic/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"56d7":function(e,t,n){"use strict";n.r(t);n("e623"),n("e379"),n("5dc8"),n("37e1");var i=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"container mt-3"},[n("div",{attrs:{id:"buttons"}},[n("button",{staticClass:"btn",on:{click:function(t){e.playing=!e.playing}}},[n("FontAwesomeIcon",{attrs:{icon:e.playing?"stop":"play"}})],1),n("button",{staticClass:"btn",class:{active:e.looping},on:{click:function(t){e.looping=!e.looping}}},[n("FontAwesomeIcon",{attrs:{icon:"undo-alt"}})],1),n("button",{staticClass:"btn float-right",on:{click:function(t){e.muted=!e.muted}}},[n("FontAwesomeIcon",{attrs:{icon:e.muted?"volume-mute":"volume-up"}})],1)]),n("div",{staticClass:"mt-3",attrs:{id:"editor"}}),n("div",{staticClass:"mt-3",attrs:{id:"piano"}}),n("div",{staticClass:"mt-3",attrs:{id:"inputs"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.inputNote,expression:"inputNote"}],staticClass:"form-control no-select",attrs:{type:"text",maxlength:"4",size:"5",placeholder:"do3"},domProps:{value:e.inputNote},on:{input:[function(t){t.target.composing||(e.inputNote=t.target.value)},e.inputNoteChanged],keypress:e.inputNoteKeyPressed}}),n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.inputMidi,expression:"inputMidi",modifiers:{number:!0}}],staticClass:"form-control no-select",class:{error:!e.isValidMidi(e.inputMidi)},attrs:{type:"number",step:"1",placeholder:"60",min:e.pianoLowNote,max:e.pianoHighNote},domProps:{value:e.inputMidi},on:{input:[function(t){t.target.composing||(e.inputMidi=e._n(t.target.value))},e.inputMidiChanged],keypress:e.inputMidiKeyPressed,blur:function(t){return e.$forceUpdate()}}})])])])},r=[],a=(n("7db0"),n("4160"),n("a15b"),n("a9e3"),n("c35ad"),n("d3b7"),n("ac1f"),n("25f0"),n("1276"),n("498a"),n("159b"),n("ddb0"),n("8cc4")),s=n.n(a),c=n("c62b"),l=n.n(c),u=n("56b3"),d=n.n(u),p=n("ddd0"),f=n.n(p),h=n("642d"),g=n.n(h),m=n("2ef0"),v={nota:["toca 60","espera 1"],arpejoDo:["toca do3","espera 1","","toca mi3","espera 1","","toca sol3","espera 1"],acordeDo:["toca do3","toca mi3","toca sol3"],cromatico:["toca do","espera 0.25","toca do#","espera 0.25","toca re","espera 0.25","toca re#","espera 0.25","toca mi","espera 0.25","toca re#","espera 0.25","toca re","espera 0.25","toca do#","espera 0.25"]},b=(n("caad6"),n("fb6a"),n("2532"),n("5319"),{parseNote:function(e){var t;return isNaN(e)?(isNaN(e.slice(-1))&&(e="".concat(e,"3")),t=this.convertPtNoteToEn(e)):t=this.convertMidiToEnNote(e,!0),t},convertPtNoteToEn:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e=e.toLowerCase(),e.includes("do")?e=e.replace("do","C"):e.includes("re")?e=e.replace("re","D"):e.includes("mi")?e=e.replace("mi","E"):e.includes("fa")?e=e.replace("fa","F"):e.includes("sol")?e=e.replace("sol","G"):e.includes("la")?e=e.replace("la","A"):e.includes("si")&&(e=e.replace("si","B")),t&&(e=g.a.note(e).interval("P8").scientific()),e},convertEnNoteToPt:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t&&(e=g.a.note(e).interval("P-8").scientific()),e=e.toUpperCase(),e.includes("C")?e=e.replace("C","do"):e.includes("D")?e=e.replace("D","re"):e.includes("E")?e=e.replace("E","mi"):e.includes("F")?e=e.replace("F","fa"):e.includes("G")?e=e.replace("G","sol"):e.includes("A")?e=e.replace("A","la"):e.includes("B")&&(e=e.replace("B","si")),e=e.toLowerCase(),e},convertMidiToEnNote:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=g.a.note.fromMIDI(e);return t?n.interval("P-8").scientific():n.scientific()},convertMidiToPtNote:function(e){var t=this.convertMidiToEnNote(e),n=this.convertEnNoteToPt(t,!0);return n},convertEnNoteToMidi:function(e){return g.a.note(e).midi()},convertPtNoteToMidi:function(e){var t=this.convertPtNoteToEn(e,!0);return g.a.note(t).midi()},getToneTimeFromOffset:function(e){return e*s.a.Time("4n")}}),y=["3024-day","3024-night","abcdef","ambiance - mobile","ambiance","base16 - dark","base16-light","bespin","blackboard","cobalt","colorforth","darcula","dracula","duotone-dark","duotone-light","eclipse","elegant","erlang-dark","gruvbox-dark","hopscotch","icecoder","idea","isotope","lesser-dark","liquibyte","lucario","material","mbo","mdn-like","midnight","monokai","neat","neo","night","oceanic-next","panda-syntax","paraiso-dark","paraiso-light","pastel-on-dark","railscasts","rubyblue","seti","shadowfox","solarized","ssms","the-matrix","tomorrow-night-bright","tomorrow-night-eighties","ttcn","twilight","vibrant-ink","xq-dark","xq-light","yeti","zenburn"],w=(n("b0c0"),n("99de")),N=n("7e84"),M=n("262e"),k=n("d4ec"),x=function e(t,n){Object(k["a"])(this,e),this.msg=t,this.line=n,this.name="Error"},P=function(e){function t(e,n){var i;return Object(k["a"])(this,t),i=Object(w["a"])(this,Object(N["a"])(t).call(this,e,n)),i.msg="a nota MIDI deve ser um número entre 48 e 84",i.name="InvalidMidi",i}return Object(M["a"])(t,e),t}(x),T=function(e){function t(e,n){var i;return Object(k["a"])(this,t),i=Object(w["a"])(this,Object(N["a"])(t).call(this,e,n)),i.msg="formato inválido de nota",i.name="InvalidNote",i}return Object(M["a"])(t,e),t}(x),C=function(e){function t(e,n){var i;return Object(k["a"])(this,t),i=Object(w["a"])(this,Object(N["a"])(t).call(this,e,n)),i.msg="a instrução terá de ser toca ou espera",i.name="InvalidInstruction",i}return Object(M["a"])(t,e),t}(x),E=n("ecee"),O=n("c074"),j=n("ad3d");n("eb8f"),n("a7be"),n("f9d4"),n("76ae");d.a.defineSimpleMode("digi-sonic-mode",{start:[{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/(function)(\s+)([a-z$][\w$]*)/,token:["keyword",null,"variable-2"]},{regex:/(?:toca|espera)\b/,token:"keyword"},{regex:/true|false|null|undefined/,token:"atom"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\/\/.*/,token:"comment"},{regex:/\/(?:[^\\]|\\.)*?\//,token:"variable-3"},{regex:/\/\*/,token:"comment",next:"comment"},{regex:/[-+\/*=<>!]+/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/[a-z$][\w$]*/,token:"variable"},{regex:/<</,token:"meta",mode:{spec:"xml",end:/>>/}}],comment:[{regex:/.*?\*\//,token:"comment",next:"start"},{regex:/.*/,token:"comment"}],meta:{dontIndentStates:["comment"],lineComment:"//"}}),E["c"].add(O["a"],O["b"],O["c"],O["e"],O["d"]),i["a"].component("FontAwesomeIcon",j["a"]);var A={name:"app",data:function(){return{playing:!1,looping:!1,muted:!1,reevalute:!1,loaded:!1,lines:[],inputNote:null,inputMidi:null,bpm:60,samples:{C3:"C3.mp3",E3:"E3.mp3",G3:"G3.mp3",C4:"C4.mp3",E4:"E4.mp3",G4:"G4.mp3"},samplesBasePath:"sounds/piano/",pianoLowNote:48,pianoHighNote:84}},mounted:function(){var e=this;this.init();var t=Object(m["debounce"])((function(){return e.resize()}),100);window.onresize=function(){t()}},watch:{playing:function(){this.playing?this.play():this.stop()},looping:function(){s.a.Transport.loop=this.looping},muted:function(){s.a.Master.mute=this.muted}},methods:{init:function(){this.initEditor(),this.initPiano(),this.initAudio(),this.initMidi()},initEditor:function(){var e=this,t=v.nota;this.editor=d()(document.querySelector("#editor"),{value:t.join("\n"),mode:"digi-sonic-mode",theme:y.find((function(e){return"mdn-like"===e})),lineNumbers:!0,gutter:!0,showCursorWhenSelecting:!0}),window.editor=this.editor,this.editor.addKeyMap({"Shift-Enter":function(){e.reevalute=!0},"Ctrl-Enter":function(){e.reevalute=!0},"Ctrl-S":function(){e.playing=!e.playing},"Ctrl-L":function(){e.looping=!e.looping}})},initPiano:function(){var e=this;this.piano=new f.a.Piano("#piano",{mode:"button",lowNote:this.pianoLowNote,highNote:this.pianoHighNote}),this.resizePiano(),this.piano.colorize("accent","var(--accent)"),this.piano.on("change",(function(t){e.pianoChanged(t)}))},initAudio:function(){var e=this;s.a.Transport.bpm.value=this.bpm,this.sampler=new s.a.Sampler(this.samples,(function(){e.loaded=!0}),this.samplesBasePath).toMaster(),s.a.Transport.on("loopEnd",(function(){e.reevalute&&(e.play(),e.reevalute=!1),e.clearPiano()}))},initMidi:function(){var e=this;l.a.enable((function(t){if(t)console.log("Web Midi API not available");else if(console.log("Web Midi API available"),0!==l.a.inputs.length){var n=l.a.inputs[0];n.addListener("noteon","all",(function(t){var n=t.note.number;n>=e.piano.settings.lowNote&&n<=e.piano.settings.highNote&&(e.inputMidi=t.note.number,e.pianoInputMidi.dispatchEvent(new Event("input")))}))}else console.log("There is no input connected right now")}))},play:function(){this.loaded&&("suspended"===s.a.context.state&&s.a.context.resume(),this.clearPiano(),s.a.Transport.cancel(0),this.schedule(),s.a.Transport.start())},stop:function(){s.a.Transport.stop(),this.clearPiano(),this.clearGutter()},schedule:function(){var e=this,t=this.editor.getValue();this.lines=t.split("\n"),this.offset=0,this.editor.getAllMarks().forEach((function(e){return e.clear()}));for(var n=0;n<this.lines.length;n++){var i=this.lines[n];try{this.processLine(i,n)}catch(r){console.log("error on line",n+1),r instanceof P||r instanceof T&&console.log("invalid note"),console.log("err.msg",r.msg),this.editor.markText({line:r.line,ch:0},{line:r.line+1,ch:0},{className:"error",title:r.msg}),s.a.Transport.cancel();break}}s.a.Transport.loopStart=0;var o=b.getToneTimeFromOffset(this.offset);s.a.Transport.loopEnd=o,s.a.Transport.schedule((function(){e.looping||(e.playing=!1)}),o)},processLine:function(e,t){var n=this;if(""!==e.trim()){var i=e.trim().split(" "),o=i[0],r=i[1],a=b.getToneTimeFromOffset(this.offset);if("toca"===o){var c=b.parseNote(r),l=b.convertPtNoteToMidi(c);if(!this.isValidMidi(l))throw new P(l,t);if(!this.isValidNote(c))throw console.log("invalid note 0"),new T(c,t);s.a.Transport.schedule((function(e){n.sampler.triggerAttackRelease(c,"4n",e),n.piano.toggleKey(l)}),a),s.a.Transport.schedule((function(){n.piano.toggleKey(l)}),b.getToneTimeFromOffset(this.offset+1))}else{if("espera"!==o)throw new C(o,t);s.a.Transport.schedule((function(){n.highlightLine(t)}),a),this.offset+=Number(r)}}},inputMidiKeyPressed:function(e){this.inputMidi?(this.inputMidi.toString().length>=2&&(console.log("preventing default"),e.preventDefault()),console.log("not preventing default")):console.log("returning")},isValidMidi:function(e){return!e||e>=this.pianoLowNote&&e<=this.pianoHighNote},isValidNote:function(){return!0},inputMidiChanged:function(){this.isValidMidi(this.inputMidi)&&""!==this.inputMidi&&(console.log("didnt return"),this.clearPiano(),this.piano.toggleKey(this.inputMidi))},inputNoteChanged:function(){if(!this.backspacing)try{var e=b.convertPtNoteToMidi(this.inputNote);this.clearPiano(),this.piano.toggleKey(e)}catch(t){console.log("invalid note format",t)}},inputNoteKeyPressed:function(e){var t=e.keyCode||e.charCode;this.backspacing=8===t||46===t},pianoChanged:function(e){if(!this.playing&&!this.playing){var t=e.note;if(e.state){this.inputMidi=t;var n=b.convertMidiToPtNote(t),i=b.convertMidiToEnNote(t,!1);this.inputNote=n,this.playing||this.sampler.triggerAttackRelease(g.a.note(i).interval("P-8").scientific(),"8n")}}},clearPiano:function(){this.piano.keys.forEach((function(e){e.state=!1}))},clearGutter:function(){var e=".CodeMirror-linenumber.CodeMirror-gutter-elt",t=document.querySelectorAll(e);t.forEach((function(e){e.classList.remove("active")}))},highlightLine:function(e){this.clearGutter();var t=".CodeMirror-linenumber.CodeMirror-gutter-elt";document.querySelectorAll(t)[e].classList.add("active")},resize:function(){this.resizePiano()},resizePiano:function(){this.pianoRatio=4;var e=document.getElementById("editor").clientWidth;this.piano.resize(e,e/this.pianoRatio),document.querySelectorAll("rect").forEach((function(e){var t=4;if(e.setAttribute("rx",t),e.setAttribute("ry",t),"#333"===e.getAttribute("fill")){var n=Number.parseFloat(e.getAttribute("width")),i=Number.parseFloat(e.getAttribute("x")),o=.75,r=i+(1-o)/2*n;e.setAttribute("width",n*o),e.setAttribute("x",r)}}))}}},S=A,I=(n("5c0b"),n("2877")),F=Object(I["a"])(S,o,r,!1,null,null,null),L=F.exports,z=n("9483");Object(z["a"])("".concat("/DigiSonic/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});n("4989"),n("ab8b");i["a"].config.productionTip=!1,i["a"].config.devtools=!1,new i["a"]({render:function(e){return e(L)}}).$mount("#app")},"5c0b":function(e,t,n){"use strict";var i=n("9c0c"),o=n.n(i);o.a},"9c0c":function(e,t,n){}});
//# sourceMappingURL=app.0886c7c9.js.map